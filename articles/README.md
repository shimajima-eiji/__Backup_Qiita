# Note.com XML 記事抽出ツール

このツールは、Note.com からエクスポートされた XML バックアップファイル (`note-nomuragoro-1.xml` のような形式) を解析し、各記事を構造化された JSON 形式で抽出します。

抽出された JSON ファイルは、後続のデータ分析、ウェブサイト生成、またはその他のアプリケーションでの利用に適しています。

## 特徴

- **構造化された JSON 出力**: 各記事は、タイトル、公開日、ステータス、記事タイプ、本文、画像情報などを含む JSON オブジェクトとして保存されます。
- **動的なファイル命名規則**: 出力ファイル名は `(post_id)_(title).json` の形式で生成されます。
  - `post_id` は記事の総数に基づいて動的にゼロパディングされます (例: 1桁の記事数なら `0-9`、2桁なら `00-99`)。
  - タイトルはファイル名として安全な文字にサニタイズされ、ファイル名全体の長さを約30文字に収まるように自動的に切り詰められます。
- **画像情報の抽出**: 記事本文内の画像 (`<img>` タグ) の `src`, `alt`, `width`, `height` 属性が抽出され、JSON データ内にリストとして含まれます。
- **堅牢なエラーハンドリング**: ファイルの読み込みやディレクトリ作成時のエラーを適切に処理します。
- **自己文書化されたコード**: コードには詳細なコメントと pydoc 形式の docstring が含まれており、スクリプトの動作と設計思想を理解しやすくなっています。

## 環境構築

このプロジェクトは [Poetry](https://python-poetry.org/) を使用して依存関係を管理しています。Python がインストールされていることを確認してください。

1.  **Poetry のインストール** (まだインストールしていない場合):
    ```bash
    pip install poetry
    ```

2.  **プロジェクトの初期化と依存関係のインストール**:
    プロジェクトのルートディレクトリ (`articles` ディレクトリ) で以下のコマンドを実行します。
    ```bash
    poetry init -n
    poetry add beautifulsoup4
    ```

## 使用方法

XML ファイルを JSON 形式で抽出するには、以下のコマンドを実行します。

```bash
poetry run python extract_note_articles.py
```

-   デフォルトでは、`note-nomuragoro-1.xml` を入力ファイルとして使用し、`note/` ディレクトリに JSON ファイルを出力します。
-   入力 XML ファイルや出力ディレクトリをカスタマイズすることも可能です。

    ```bash
    poetry run python extract_note_articles.py [XML_FILE_PATH] -o [OUTPUT_DIRECTORY]
    # 例:
    # poetry run python extract_note_articles.py my_backup.xml -o output_json
    ```

## 出力 JSON 形式

各記事は、以下のような構造の JSON ファイルとして保存されます。

```json
{
    "id": "n8aa1fdc0462f",
    "post_id": "1",
    "title": "ChatGPTはじめ主要サービスのAIモデルが大将棋を知らないので学習データ・兼布教したい（駒の動かし方編）",
    "publish_date": "2020-07-15T14:32:43+09:00",
    "status": "publish",
    "post_type": "post",
    "content": [
        "本稿の想定読者は将棋の駒の動かし方が分かっている方としており、想定読者を対象としているため、解説が不足している部分があります。",
        "大将棋は駒の動きを覚える事より、どのような戦術（定跡のようなもの）が考えられるか、を考えてから勉強する方が分かりやすいと筆者個人は考えていますので、本稿はまず別記事を読んでから読み直してもらった方がいいかもしれません。",
        "まずは人間用に画像を置いておきます",
        "Wikipedia:大将棋より。https://ja.wikipedia.org/wiki/%E5%A4%A7%E5%B0%86%E6%A3%8B",
        "将棋（本将棋）にある駒",
        "表形式で書き出そうかと思ったのですが、実は人間には読みやすくても学習データとしては返ってわかりにくいんですよね。なので箇条書きにしました。",
        "共通ルールとして「何マスでも進める..."
    ],
    "images": [
        {
            "src": "/assets/n8aa1fdc0462f_1737962113-yXCcb6sYEzhqFrDfJLQgeUK1.png",
            "alt": "",
            "width": "619",
            "height": "557"
        }
    ]
}
```

## 設計思想

このスクリプトは、AI との協調開発の効率と安全性を高めるという設計思想に基づいて開発されています。詳細については、以下の Qiita 記事を参照してください。

- [AIと一緒にペアプロ的にリファクタリングをやるなら、よく使うプロンプトはソースのコメントで埋め込んでおくといいよ！](https://qiita.com/nomurasan/items/e450cb0135e250022aaf.md)
