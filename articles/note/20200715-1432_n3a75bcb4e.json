{
    "id": "n3a75bcb4e",
    "title": "microCMSを無料枠で効率的に使うために、サービスをいかに削れるか考える。",
    "publish_date": "2020-07-15T14:32:43+09:00",
    "status": "publish",
    "post_type": "post",
    "content": [
        "※運用の話が強めです。",
        "Qiitaに公開しようかと思ったんですが、一般公開するとすぐに規制対象になりそうなので有料です。",
        "私は、ブログのコンテンツも、複数のブログで使い回すサイトガチェットも、インターフェースとしてのGASも色々と使っており、データ管理を一元化したいなと思っていました。",
        "今まではスプレッドシートをデータベースのように使っていたのですが、システム用に作ったファイルと要件定義など業務で作っているドキュメントとしてのファイルが混在しており、非常に管理が煩雑になっていました。",
        "ディレクトリで分けたりファイル名で工夫したり、と思いつく事を色々やったんですが、そもそも単一ファイルとしてスプレッドシートで巨大なコンテンツを扱うのが難しい（やってやれないことはないですが、ブログの記事をスプレッドシートに書いてGitで管理する場合などは非常に手間）ので、これを解消する方法です。",
        "何が嬉しいの？",
        "・microCMSの無料プランだとサービスの利用数に制限がある。これを擬似的に解決できる。",
        "・各サービスの一部に変更があった場合でもすべてのアプリに変更を適用できる（DBっぽい使い方ができる）",
        "後者はスプレッドシートでもできるので、ここで取り上げたいのは前者です。",
        "有料設定にあたって",
        "microCMSの公式：料金設定（https://microcms.io/pricing/）",
        "に従いました。",
        "ただし、月々ではなく買い切りの料金です。",
        "本記事でやろうとしていることは、FreeプランでAPI制限が10個しかないので少ないと感じた人にとって価値がある内容です。",
        "具体的には開発者やブロガーの方を対象としています。",
        "これだけの内容で高い料金を払うのも嫌だと思うので、本記事を読んで個人でも実質無制限のAPI数を導入をしてみようと思った方への導入サポートも含むことにしました。",
        "なお、記事中にも書いていますが、あくまで個人用ですので、",
        "商用ラインに乗せるものはリスクマネジメントの観点から、",
        "この方法で対応しないでください。",
        "記事内で使用している画像",
        "これだけでピンと来たら自分でできます。頑張ってください。",
        "解説：microCMSの設定",
        "全体としては、このように管理しています。",
        "コンテンツに着目していきましょう。",
        "○○の許可設定",
        "この内容でスキーマを作成します。",
        "schema.json",
        "[",
        "{",
        "\"fieldId\": \"value\",",
        "\"name\": \"値\",",
        "\"kind\": \"text\",",
        "\"description\": \"許可するコンテンツAPI名を設定する。【要変更】作成したcontentIdはkeyとして使用する\",",
        "\"required\": true",
        "}",
        "]",
        "一つしか項目がないのでとてもシンプルです。",
        "ここで作成する値は、同じサービス内のコンテンツAPI名です。​",
        "たとえば、「お絵かきLINEBOTの許可設定」の場合はlineのコンテンツAPIだけを使わせたいので、値にはlineだけとします。",
        "「slack-line連携の許可設定」の場合は、lineとslackのコンテンツAPIを使わせたいので、値にはlineとslackを登録します。",
        "各コンテンツAPIはこのようになっています。",
        "先程のスキーマを使いまわしていますが、解説用に「メモ」を追加しました。​",
        "https://gist.github.com/shimajima-eiji/c10e586f1257fa3981032ce8d9af7084#file-microcms-gs",
        "全体のスクリプトとしてはこうなります。",
        "microCMS.gsで設定するPERMISSION_CONTENTIDはそれぞれの許可設定で指定したものです。",
        "これを間違えると大変な事になります。",
        "解説はコメントの通りですが、`findValue_array`は`...contents.filter((object)=>object.id==target)`です。",
        "私はまだGASのV8ランタイムを採用していないので泥臭い事をやっています…",
        "問題点",
        "その他のサービスアプリで使用するAPIキーが共通なので、一つが漏洩すれば関係するサービスすべてが漏洩した事になるため、リスク管理の観点からはおすすめしません。",
        "私はあくまで開発を楽しみたい個人で活用しているので",
        "商用ラインで使っている場合はきちんとサービスを分けましょう。"
    ],
    "images": [
        {
            "src": "/assets/n3a75bcb4ef8e_195b778209b3ce0218fedb61853ee3f9.png",
            "alt": "",
            "width": null,
            "height": null
        },
        {
            "src": "/assets/n3a75bcb4ef8e_picture_pc_9cb1e93103bd56e9b518c37bfee1e691.png",
            "alt": "許可設定",
            "width": "620",
            "height": "210"
        },
        {
            "src": "/assets/n3a75bcb4ef8e_picture_pc_b673c61545bc83f675fe6eb53545e8cd.png",
            "alt": "コンテンツ",
            "width": "620",
            "height": "228"
        },
        {
            "src": "/assets/n3a75bcb4ef8e_picture_pc_aceb38ccc4b3b169d05841d99d42257e.png",
            "alt": "許可設定",
            "width": "620",
            "height": "210"
        },
        {
            "src": "/assets/n3a75bcb4ef8e_picture_pc_6e44735314d3564f7574ac4b403275a8.png",
            "alt": "コンテンツ",
            "width": "620",
            "height": "228"
        }
    ]
}